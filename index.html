<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Tu Guía SIBO y Dieta Personalizada"
    />
    <link rel="apple-touch-icon" href="/logo192.png" />
    <link rel="manifest" href="/manifest.json" />
    <title>Tu Guía SIBO y Dieta Personalizada</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Asegura que el body use el 100% del alto disponible */
      html, body, #root {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      /* Estilos para los círculos de intensidad (se mantienen por si se reintroduce la funcionalidad) */
      .severity-circle {
        width: 24px; /* Tamaño del círculo */
        height: 24px;
        border-radius: 50%; /* Hacerlo redondo */
        border: 2px solid theme('colors.gray.500'); /* Borde para los no seleccionados */
        cursor: pointer;
        transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
      }
      .severity-circle.selected-1 { background-color: theme('colors.green.500'); border-color: theme('colors.green.600'); }
      .severity-circle.selected-2 { background-color: theme('colors.yellow.500'); border-color: theme('colors.yellow.600'); }
      .severity-circle.selected-3 { background-color: theme('colors.red.500'); border-color: theme('colors.red.600'); }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      // --- DIET DATA ---
      const dietPlan = [
        {
          day: 'Lunes',
          breakfast: [
            'Leche de almendras (sin azúcar, sin gomas) (150ml) con copos de avena certificados sin gluten (30g) cocidos con agua y canela.',
            '1/2 taza de arándanos frescos.',
            '1 cucharada de proteína en polvo (sin FODMAPs ni azúcares).'
          ],
          midMorning: '1 kiwi.',
          snacksBetweenMeals: [
            '1 huevo cocido.',
            'Palitos de zanahoria.'
          ],
          lunch: [
            'Pechuga de pollo a la plancha (150g, sin piel).',
            'Arroz blanco (50g en crudo).',
            'Salteado ligero de espinacas y zanahorias (150g) (mínimo AOVE, sin ajo/cebolla).',
            'Yogur natural desnatado sin lactosa.'
          ],
          snack: '1 plátano pequeño (poco maduro).',
          dinner: [
            'Merluza al horno (200g).',
            'Judías verdes al vapor (aprox. 75g, muy bajo en carbos).'
          ]
        },
        {
          day: 'Martes',
          breakfast: [
            'Huevos revueltos (2 unidades) con rodajas de tomate y albahaca fresca (mínimo AOVE).',
            '1 rebanada de pan de arroz tostado.'
          ],
          midMorning: '1 plátano pequeño (poco maduro).',
          snacksBetweenMeals: [
            '2-3 lonchas de jamón cocido (verificar: sin lactosa, sin dextrosa, sin azúcares/FODMAPs).'
          ],
          lunch: [
            'Lomo de cerdo magro a la plancha (150g, retirar grasa visible).',
            'Quinoa (50g en crudo).',
            'Ensalada de lechuga, pepino y pimiento rojo (150g) (porción controlada).',
            'Yogur natural desnatado sin lactosa.'
          ],
          snack: '1 kiwi.',
          dinner: [
            'Atún al natural (bien escurrido, 100g de peso escurrido).',
            'Salsa de tomate casera (solo tomate triturado, pizca de AOVE, albahaca, sal, sin cebolla/ajo).',
            'Judías verdes al vapor (aprox. 100g).'
          ]
        },
        {
          day: 'Miércoles',
          breakfast: [
            'Yogur natural desnatado sin lactosa con 1/2 taza de fresas y 1 cucharada de semillas de chía.',
            'Infusión de menta.'
          ],
          midMorning: '1 kiwi.',
          snacksBetweenMeals: [
            'Pechuga de pollo fría a la plancha (50g).' 
          ],
          lunch: [
            'Pechuga de pavo a la plancha (150g, sin piel).',
            'Patatas hervidas (150g).',
            'Acelgas hervidas con tomate triturado natural (150g) (sin ajo/cebolla).',
            'Yogur natural desnatado sin lactosa.'
          ],
          snack: '1 plátano pequeño (poco maduro).',
          dinner: [
            'Trucha (o lenguado/platija) a la plancha (200g).',
            'Puntas de espárragos (1/2 taza) salteadas con mínimo AOVE.',
            'Arroz blanco (50g en crudo).'
          ]
        },
        {
          day: 'Jueves',
          breakfast: [
            'Batido: 1 taza de leche de arroz (sin azúcar), 1 cucharada de proteína en polvo (sin FODMAPs ni azúcares).'
          ],
          midMorning: '1 plátano pequeño (poco maduro).',
          snacksBetweenMeals: [
            'Rodajas de pepino (100g).',
            '1 huevo cocido.'
          ],
          lunch: [
            'Sepia o pota a la plancha (150g).',
            'Quinoa (50g en crudo).',
            'Salteado de calabacín y zanahoria (150g) (mínimo AOVE, sin ajo/cebolla).',
            'Yogur natural desnatado sin lactosa.'
          ],
          snack: '1 kiwi.',
          dinner: [
            'Asado de ternera magra (sin grasa visible, 180g).',
            'Patatas hervidas (150g).',
            'Ensalada de lechuga y tomate (150g).'
          ]
        },
        {
          day: 'Viernes',
          breakfast: [
            'Tortilla de 2 claras de huevo con pimiento verde picado (mínimo AOVE).',
            '1/2 taza de arándanos frescos.',
            'Infusión de jengibre.'
          ],
          midMorning: '1 kiwi.',
          snacksBetweenMeals: [
            'Pechuga de pavo fría a la plancha (50g).'
          ],
          lunch: [
            'Pechuga de pollo desmenuzada (150g).',
            'Arroz blanco (50g en crudo).',
            'Judías verdes al vapor (100g) con rodajas de tomate.',
            'Yogur natural desnatado sin lactosa.'
          ],
          snack: '1 plátano pequeño (poco maduro).',
          dinner: [
            'Bacalao al vapor (200g).',
            'Crema de verduras bajas en FODMAP (calabacín, zanahoria; hecha con caldo casero, mínimo AOVE, sin cebolla/ajo).'
          ]
        },
        {
          day: 'Sábado',
          breakfast: [
            'Leche de almendras (sin azúcar) (150ml) con copos de avena certificados sin gluten (30g) cocidos con agua y canela.',
            '1/2 taza de arándanos frescos.'
          ],
          midMorning: '1 plátano pequeño (poco maduro).',
          snacksBetweenMeals: [
            '1 huevo cocido.',
            'Hojas de lechuga.'
          ],
          lunch: [
            'Lomo de cerdo magro a la plancha (150g).',
            'Patatas asadas (150g).',
            'Ensalada de pepino y zanahoria (150g).',
            'Yogur natural desnatado sin lactosa.'
          ],
          snack: '1 kiwi.',
          dinner: [
            'Merluza a la plancha (200g).',
            'Quinoa (50g en crudo).',
            'Salteado de espinacas y pimiento rojo (150g) (mínimo AOVE).'
          ]
        },
        {
          day: 'Domingo',
          breakfast: [
            'Huevos pasados por agua (2 unidades).',
            '1/2 taza de arándanos frescos.',
            '1 rebanada de pan de arroz tostado.'
          ],
          midMorning: '1 kiwi.',
          snacksBetweenMeals: [
            '2-3 lonchas de jamón serrano (en porciones moderadas).'
          ],
          lunch: [
            'Asado de ternera magra (sin grasa visible, 180g).',
            'Arroz blanco (50g en crudo).',
            'Ensalada de lechuga y zanahoria rallada (150g).',
            'Yogur natural desnatado sin lactosa.'
          ],
          snack: '1 plátano pequeño (poco maduro).',
          dinner: [
            'Merluza a la plancha (200g).',
            'Calabacín y pimiento verde a la plancha (150g) (mínimo AOVE).'
          ]
        },
      ];

      // --- SHOPPING LIST DATA ---
      const shoppingList = {
        'Lácteos y Alternativas': [
          'Leche desnatada sin lactosa',
          'Yogures desnatados sin lactosa (naturales, sin azúcares añadidos)',
          'Queso fresco desnatado sin lactosa',
          'Bebida vegetal de almendras o arroz (sin azúcares añadidos, sin inulina/goma guar/otras gomas)'
        ],
        'Proteínas (Prioridad Magra y Baja en Purinas)': [
          'Pechuga de pollo',
          'Muslos de pollo sin piel',
          'Pechuga de pavo',
          'Lomo de cerdo (corte magro)',
          'Cordero (cortes muy magros, moderar consumo)',
          'Carne de ternera magra para asar (moderar a 1-2 veces/semana)',
          'Merluza',
          'Trucha',
          'Lubina',
          'Bacalao',
          'Lenguado o Platija',
          'Sepia o Pota',
          'Atún al natural (en lata, escurrir bien)',
          'Huevos',
          'Jamón serrano (en porciones moderadas)',
          'Jamón cocido (verificar: sin lactosa, sin dextrosa, sin azúcares añadidos)'
        ],
        'Verduras (Estrictamente Bajas en FODMAP - ¡Solo estas!)': [
          'Espinacas',
          'Lechuga (todas las variedades)',
          'Pepino',
          'Zanahorias',
          'Calabacín',
          'Pimiento rojo (porción controlada)',
          'Tomates (preferiblemente cherry o sin semillas si eres sensible)',
          'Acelgas',
          'Endivias',
          'Judías verdes (en porciones controladas, aprox. 75g-100g)',
          'Puntas de espárragos (porción controlada, aprox. 1/2 taza)',
        ],
        'Frutas (MUY Limitadas y Estrictamente Bajas en Fructosa/FODMAP - ¡Atención a las porciones!)': [
          'Arándanos (máx. 1/4 taza)',
          'Fresas (máx. 5-6 pequeñas)',
          'Kiwi (1 unidad)',
          'Plátanos verdes/poco maduros (1/2 unidad, no maduros)',
        ],
        'Cereales y Tubérculos (Sin Gluten, Sin Azúcares Añadidos)': [
          'Pan sin gluten (de arroz o maíz puro, verificar ingredientes)',
          'Pasta sin gluten (de arroz o maíz)',
          'Copos de avena certificados sin azúcar (verificar ingredientes)',
          'Quinoa',
          'Arroz blanco',
          'Patatas (para hervir/asar, sin recalentar)',
          'Boniato (porción controlada, si se reintroduce y tolera)',
          'Tortitas de maíz/arroz (verificar sin azúcares añadidos ni fructosa)',
          'Fideos de arroz o maíz (para sopas)'
        ],
        'Grasas y Aceites': [
          'Aceite de oliva virgen extra (cantidad controlada)',
          'Semillas de chía',
          'Semillas de lino molidas'
        ],
        'Varios y Especias': [
          'Hierbas frescas (perejil, cilantro, romero, tomillo, albahaca, eneldo)',
          'Especias (sal, pimienta, pimentón dulce, comino, cúrcuma, jengibre en polvo)',
          'Caldo de verduras o pollo casero (hecho con huesos, zanahoria, tallo de apio, sin cebolla, sin ajo, sin puerro)',
          'Tomate triturado natural (verificar sin cebolla/ajo)',
          'Edulcorantes (estevia, sacarina, aspartamo, si los toleras)'
        ],
        'Suplementos (¡Consulta a tu médico/nutricionista para ajuste de dosis y nuevos!)': [
          'Probiótico Ironmax',
          'Perlas de Orégano',
          'Magnesio (Citrato de Magnesio Terra Verda)',
          'Savia de Paleobull (Creatina, Magnesio, Potasio) - ¡RECUERDA SUMAR EL MAGNESIO DE AMBOS SUPLEMENTOS!',
          'Elixir de Paleobull (Colágeno + Aceite TCM)',
          'Considerar seriamente con tu médico: Suplemento de Vitamina D3 + K2 (dada tu deficiencia de Vitamina D)',
          'Considerar seriamente con tu médico: Suplemento de Vitamina B12 (dada tu B12 en límite inferior)',
          'Considerar seriamente con tu médico: Suplemento de Vitamina C (dada tu deficiencia)',
          'Considerar seriamente con tu médico: Suplemento de Omega 3 (para colesterol, inflamación y salud general)'
        ]
      };

      // --- INFO DATA ---
      const infoContent = {
        sibo: {
          title: '¿Qué es el SIBO?',
          text: 'El SIBO (Sobrecrecimiento Bacteriano del Intestino Delgado) es una condición donde hay un aumento excesivo de bacterias en el intestino delgado. Normalmente, la mayoría de las bacterias residen en el intestino grueso. Tu prueba de SIBO fue positiva, con un componente significativo de Metano (IMO), lo que puede asociarse con estreñimiento y hacer el tratamiento más complejo.'
        },
        fructose: {
          title: 'Malabsorción de Fructosa',
          text: 'La malabsorción de fructosa, también conocida como intolerancia a la fructosa, ocurre cuando el intestino delgado no puede absorber adecuadamente este azúcar, lo que provoca problemas digestivos. Los síntomas comunes incluyen dolor abdominal, hinchazón, gases y diarrea. Esta condición no debe confundirse con la intolerancia hereditaria a la fructosa, que es una enfermedad más grave. La fructosa es un azúcar presente de forma natural en frutas, miel y algunos vegetales, así como en productos procesados como dulces y bebidas. En la malabsorción de fructosa, el intestino delgado no puede absorber completamente la fructosa, y esta pasa al colon donde las bacterias la fermentan, generando gases y otros síntomas. Tu prueba de fructosa fue positiva con una elevación muy significativa de hidrógeno y metano.'
        },
        lactose: {
          title: 'Malabsorción de Lactosa',
          text: 'La malabsorción de lactosa, también llamada intolerancia a la lactosa, ocurre cuando el intestino delgado no puede digerir la lactosa, un azúcar presente en la leche y productos lácteos, debido a la falta de la enzima lactasa. Esto provoca que la lactosa no absorbida llegue al colon, donde es fermentada por bacterias, generando síntomas como gases, hinchazón abdominal y diarrea. Tu prueba de lactosa fue positiva con elevaciones importantes de hidrógeno y metano.'
        },
        dietPurpose: {
          title: 'Propósito de esta Dieta',
          text: 'Esta dieta es una Fase de Eliminación Rigurosa de FODMAPs, diseñada para reducir la fermentación bacteriana en tu intestino, aliviar tus síntomas y preparar tu cuerpo para un tratamiento más efectivo del SIBO. También está ajustada para ser baja en grasas saturadas, apoyar tus niveles de colesterol y triglicéridos, y considerar tu función renal. Es crucial seguirla estrictamente y no es una dieta para mantener a largo plazo sin reintroducción.'
        },
        importantNotes: {
          title: 'Notas Importantes Adicionales',
          text: '1. **Consulta Profesional:** Esta app es una guía. Es fundamental que un gastroenterólogo y un dietista-nutricionista especializado en SIBO revisen tu caso y ajusten el plan. 2. **Causa Subyacente del SIBO:** La dieta y los suplementos ayudan, pero es VITAL que tu médico investigue y trate la causa raíz de tu SIBO (ej. problemas de motilidad intestinal) para evitar recaídas. 3. **Suplementos:** Revisa las dosis de magnesio que tomas de ambos suplementos. Discute con tu médico la suplementación de Vitamina D3+K2, B12 y Omega 3, ya que tus análisis muestran deficiencias o niveles bajos. 4. **Pérdida de Peso:** El SIBO no resuelto puede dificultar la pérdida de peso. Abordar el SIBO es clave para normalizar tu metabolismo y facilitar el control del peso.'
        }
      };

      // Main App Component
      function App() {
        const [activeTab, setActiveTab] = React.useState('diet');
        const [currentDayIndex, setCurrentDayIndex] = React.useState(0);

        // Estados para el Diario de Síntomas
        const [selectedDate, setSelectedDate] = React.useState(new Date().toISOString().slice(0, 10));
        // Se elimina mealsEaten como string
        // const [mealsEaten, setMealsEaten] = React.useState('');
        const [symptomNotes, setSymptomNotes] = React.useState('');
        const [selectedSymptoms, setSelectedSymptoms] = React.useState({}); // Mantener este estado aunque no se use en el form para no romper el historial
        const [logMessage, setLogMessage] = React.useState('');
        const [symptomLogs, setSymptomLogs] = React.useState([]);
        const [viewingLog, setViewingLog] = React.useState(null);

        // Nuevos estados para controlar la expansión de los grupos
        const [expandedYears, setExpandedYears] = React.useState({}); 
        const [expandedMonths, setExpandedMonths] = React.useState({}); 
        const [expandedWeeks, setExpandedWeeks] = React.useState({}); 

        // Estados para el NUEVO registro de ingestas
        const ingestionTypes = ['Desayuno', 'Media Mañana', 'Comida', 'Merienda', 'Cena', 'Snack'];
        const [currentIngestionType, setCurrentIngestionType] = React.useState(ingestionTypes[0]);
        const [currentIngestionDescription, setCurrentIngestionDescription] = React.useState('');
        const [currentIngestionReaction, setCurrentIngestionReaction] = React.useState(''); // Bien, Regular, Mal
        const [dailyIngestas, setDailyIngestas] = React.useState([]); // Array de ingestas para el día actual

        // Common Symptoms (se mantienen por si el historial los necesita para mostrar detalles de logs antiguos)
        const commonSymptoms = [
          'Hinchazón', 'Gases', 'Diarrea', 'Estreñimiento'
        ];

        // Función para añadir una ingesta al listado del día
        const addIngestion = () => {
          if (!currentIngestionDescription.trim()) {
            setLogMessage('Por favor, describe la comida antes de añadirla.');
            return;
          }
          if (!currentIngestionReaction) {
            setLogMessage('Por favor, selecciona cómo te sentó la comida.');
            return;
          }

          const newIngestion = {
            type: currentIngestionType,
            description: currentIngestionDescription,
            reaction: currentIngestionReaction
          };
          setDailyIngestas(prev => [...prev, newIngestion]);
          
          // Resetear campos de la ingesta
          setCurrentIngestionDescription('');
          setCurrentIngestionReaction('');
          setLogMessage(''); // Limpiar mensajes
        };

        // Función para eliminar una ingesta del listado del día (antes de guardar el log completo)
        const removeIngestion = (indexToRemove) => {
          setDailyIngestas(prev => prev.filter((_, index) => index !== indexToRemove));
        };


        // Función auxiliar para obtener el número de semana del año (ISO 8601)
        const getWeekNumber = (d) => {
          d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
          d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7)); 
          var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
          var weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
          return weekNo;
        };

        // Cargar registros del localStorage al inicio
        React.useEffect(() => {
          const storedLogs = localStorage.getItem('siboSymptomLogs');
          if (storedLogs) {
            const parsedLogs = JSON.parse(storedLogs).map(log => ({
                ...log,
                date: new Date(log.date), 
                timestamp: new Date(log.timestamp) 
            }));
            parsedLogs.sort((a, b) => b.timestamp - a.timestamp);
            setSymptomLogs(parsedLogs);
          }
        }, []);

        // Función para guardar el registro COMPLETO del día
        const saveSymptomLog = () => {
          if (dailyIngestas.length === 0 && !symptomNotes.trim()) {
            setLogMessage('Por favor, ingresa al menos una comida o una nota para el día.');
            return;
          }

          const newLog = {
            date: new Date(selectedDate),
            ingestas: dailyIngestas, // AHORA ES UN ARRAY DE INGESTAS
            symptoms: selectedSymptoms, // Mantenemos por compatibilidad con logs antiguos, pero ya no se edita aquí
            notes: symptomNotes,
            timestamp: new Date()
          };

          const updatedLogs = [...symptomLogs, newLog];
          updatedLogs.sort((a, b) => b.timestamp - a.timestamp); 
          localStorage.setItem('siboSymptomLogs', JSON.stringify(updatedLogs)); 
          setSymptomLogs(updatedLogs);
          setLogMessage('¡Registro del día guardado con éxito!');

          // Limpiar el formulario completo del día
          setSelectedDate(new Date().toISOString().slice(0, 10));
          setDailyIngestas([]); // Limpiar ingestas del día
          setSymptomNotes('');
          setSelectedSymptoms({}); 
          setLogMessage(''); 
        };

        // Función Eliminar un registro del diario (en el historial)
        const deleteSymptomLog = (logToDeleteTimestamp) => {
            if (window.confirm('¿Estás seguro de que quieres eliminar este registro?')) {
                const updatedLogs = symptomLogs.filter(log => log.timestamp.toISOString() !== logToDeleteTimestamp);
                localStorage.setItem('siboSymptomLogs', JSON.stringify(updatedLogs));
                setSymptomLogs(updatedLogs);
                setViewingLog(null); 
                setLogMessage('Registro eliminado con éxito.');
            }
        };


        // Funciones para alternar la expansión
        const toggleYear = (year) => {
          setExpandedYears(prev => ({ ...prev, [year]: !prev[year] }));
        };
        const toggleMonth = (year, month) => {
          setExpandedMonths(prev => ({ ...prev, [`${year}-${month}`]: !prev[`${year}-${month}`] }));
        };
        const toggleWeek = (year, week) => {
          setExpandedWeeks(prev => ({ ...prev, [`${year}-${week}`]: !prev[`${year}-${week}`] }));
        };


        // Función para agrupar los registros por Año, Mes y Semana
        const groupLogs = (logs) => {
          const grouped = {}; 

          logs.forEach(log => {
            const date = log.date; 
            const year = date.getFullYear();
            const month = date.toLocaleString('es-ES', { month: 'long' }); 
            const week = getWeekNumber(date);

            if (!grouped[year]) grouped[year] = {};
            if (!grouped[year][month]) grouped[year][month] = {};
            if (!grouped[year][month][week]) grouped[year][month][week] = [];

            grouped[year][month][week].push(log);
          });
          return grouped;
        };

        const groupedSymptoms = groupLogs(symptomLogs);

        const currentDay = dietPlan[currentDayIndex];

        return (
          <div className="min-h-screen bg-gray-900 font-sans antialiased flex flex-col items-center p-4 sm:p-6">
            {/* Header */}
            <header className="w-full max-w-4xl bg-gradient-to-r from-gray-800 to-gray-950 text-white p-6 rounded-lg shadow-lg mb-8 text-center">
              <h1 className="text-3xl sm:text-4xl font-bold mb-2">Tu Guía SIBO y Dieta Personalizada</h1>
              <p className="text-lg sm:text-xl">Manejo de SIBO, Intolerancia a Fructosa y Lactosa</p>
            </header>

            {/* Navigation Tabs */}
            <nav className="w-full max-w-4xl bg-gray-800 p-3 rounded-lg shadow-md flex justify-around mb-6">
              <button
                onClick={() => setActiveTab('diet')}
                className={`px-4 py-2 text-sm sm:text-base font-semibold rounded-md transition-colors duration-200 ${
                  activeTab === 'diet' ? 'bg-blue-700 text-white shadow-md' : 'text-gray-300 hover:bg-gray-700'
                }`}
              >
                Dieta Semanal
              </button>
              <button
                onClick={() => setActiveTab('shopping')}
                className={`px-4 py-2 text-sm sm:text-base font-semibold rounded-md transition-colors duration-200 ${
                  activeTab === 'shopping' ? 'bg-blue-700 text-white shadow-md' : 'text-gray-300 hover:bg-gray-700'
                }`}
              >
                Lista de la Compra
              </button>
              <button
                onClick={() => setActiveTab('info')}
                className={`px-4 py-2 text-sm sm:text-base font-semibold rounded-md transition-colors duration-200 ${
                  activeTab === 'info' ? 'bg-blue-700 text-white shadow-md' : 'text-gray-300 hover:bg-gray-700'
                }`}
              >
                Información Clave
              </button>
              <button
                onClick={() => setActiveTab('symptoms')}
                className={`px-4 py-2 text-sm sm:text-base font-semibold rounded-md transition-colors duration-200 ${
                  activeTab === 'symptoms' ? 'bg-blue-700 text-white shadow-md' : 'text-gray-300 hover:bg-gray-700'
                }`}
              >
                Diario
              </button>
              <button
                onClick={() => setActiveTab('favorites')} // Nueva pestaña
                className={`px-4 py-2 text-sm sm:text-base font-semibold rounded-md transition-colors duration-200 ${
                  activeTab === 'favorites' ? 'bg-blue-700 text-white shadow-md' : 'text-gray-300 hover:bg-gray-700'
                }`}
              >
                Mis Favoritos
              </button>
            </nav>

            {/* Content Area */}
            <main className="w-full max-w-4xl bg-gray-800 p-6 rounded-lg shadow-lg">
              {activeTab === 'diet' && (
                <div className="diet-plan-section">
                  <h2 className="text-2xl sm:text-3xl font-bold text-white mb-4 text-center">Dieta Semanal</h2>
                  <div className="flex justify-between items-center mb-4">
                    <button
                      onClick={() => setCurrentDayIndex((prev) => (prev === 0 ? dietPlan.length - 1 : prev - 1))}
                      className="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200 shadow-sm"
                    >
                      Anterior
                    </button>
                    <h3 className="text-xl sm:text-2xl font-semibold text-blue-400">{currentDay.day}</h3>
                    <button
                      onClick={() => setCurrentDayIndex((prev) => (prev === dietPlan.length - 1 ? 0 : prev + 1))}
                      className="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200 shadow-sm"
                    >
                      Siguiente
                    </button>
                  </div>

                  <div className="space-y-4">
                    <div className="bg-gray-700 p-4 rounded-md shadow-sm">
                      <h4 className="font-bold text-lg text-blue-300">Desayuno:</h4>
                      <ul className="list-disc list-inside text-gray-200">
                        {currentDay.breakfast.map((item, index) => (
                          <li key={index}>{item}</li>
                        ))}
                      </ul>
                    </div>
                    <div className="bg-gray-700 p-4 rounded-md shadow-sm">
                      <h4 className="font-bold text-lg text-green-300">Almuerzo (Media Mañana):</h4>
                      <p className="text-gray-200">{currentDay.midMorning}</p>
                    </div>
                    {currentDay.snacksBetweenMeals && currentDay.snacksBetweenMeals.length > 0 && (
                      <div className="bg-gray-700 p-4 rounded-md shadow-sm">
                        <h4 className="font-bold text-lg text-orange-300">Entre Comidas:</h4>
                        <ul className="list-disc list-inside text-gray-200">
                          {currentDay.snacksBetweenMeals.map((item, index) => (
                            <li key={index}>{item}</li>
                          ))}
                        </ul>
                      </div>
                    )}
                    <div className="bg-gray-700 p-4 rounded-md shadow-sm">
                      <h4 className="font-bold text-lg text-yellow-300">Comida:</h4>
                      <ul className="list-disc list-inside text-gray-200">
                        {currentDay.lunch.map((item, index) => (
                          <li key={index}>{item}</li>
                        ))}
                      </ul>
                    </div>
                    <div className="bg-gray-700 p-4 rounded-md shadow-sm">
                      <h4 className="font-bold text-lg text-purple-300">Merienda:</h4>
                      <p className="text-gray-200">{currentDay.snack}</p>
                    </div>
                    <div className="bg-gray-700 p-4 rounded-md shadow-sm">
                      <h4 className="font-bold text-lg text-red-300">Cena:</h4>
                      <ul className="list-disc list-inside text-gray-200">
                        {currentDay.dinner.map((item, index) => (
                          <li key={index}>{item}</li>
                        ))}
                      </ul>
                    </div>
                  </div>
                </div>
              )}

              {activeTab === 'shopping' && (
                <div className="shopping-list-section">
                  <h2 className="text-2xl sm:text-3xl font-bold text-white mb-4 text-center">Lista de la Compra</h2>
                  <div className="space-y-6">
                    {Object.entries(shoppingList).map(([category, items]) => (
                      <div key={category} className="bg-gray-700 p-4 rounded-md shadow-sm">
                        <h3 className="font-bold text-xl text-blue-400 mb-2">{category}</h3>
                        <ul className="list-disc list-inside text-gray-200 space-y-1">
                          {items.map((item, index) => (
                            <li key={index}>{item}</li>
                          ))}
                        </ul>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {activeTab === 'info' && (
                <div className="info-section space-y-6">
                  <h2 className="text-2xl sm:text-3xl font-bold text-white mb-4 text-center">Información Clave</h2>
                  {Object.entries(infoContent).map(([key, content]) => (
                    <div key={key} className="bg-gray-700 p-4 rounded-md shadow-sm">
                      <h3 className="font-bold text-xl text-blue-300 mb-2">{content.title}</h3>
                      <p className="text-gray-200">{content.text}</p>
                    </div>
                  ))}
                </div>
              )}

              {activeTab === 'symptoms' && (
                <div className="symptoms-diary-section space-y-6">
                  <h2 className="text-2xl sm:text-3xl font-bold text-white mb-4 text-center">Diario</h2> {/* CAMBIO DE NOMBRE A "DIARIO" */}
                  
                  {viewingLog ? ( // Si hay un registro seleccionado, mostrar detalles
                    <div className="bg-gray-700 p-4 rounded-md shadow-sm space-y-4">
                      <button 
                        onClick={() => setViewingLog(null)} 
                        className="px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors duration-200 mb-4"
                      >
                        ← Volver a la lista
                      </button>
                      <h3 className="text-xl font-bold text-blue-400 mb-2">Detalle del Registro del {new Date(viewingLog.date).toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</h3>
                      
                      <div>
                        <h4 className="font-bold text-lg text-gray-300">Comidas Registradas:</h4>
                        {viewingLog.ingestas && viewingLog.ingestas.length > 0 ? (
                            <ul className="list-disc list-inside text-gray-200 space-y-1">
                                {viewingLog.ingestas.map((ingesta, idx) => (
                                    <li key={idx}>
                                        <span className="font-semibold">{ingesta.type}:</span> {ingesta.description} (<span className={`font-semibold ${
                                            ingesta.reaction === 'Bien' ? 'text-green-400' :
                                            ingesta.reaction === 'Regular' ? 'text-yellow-400' : 'text-red-400'
                                        }`}>{ingesta.reaction}</span>)
                                    </li>
                                ))}
                            </ul>
                        ) : (
                            <p className="text-gray-200">Ninguna comida registrada para este día.</p>
                        )}
                      </div>

                      {/* Sección de Síntomas Reportados (anterior) - Si se quiere volver a poner la de los botones, se activaría aquí */}
                      {/* Por ahora solo muestra los que se guardaron en logs antiguos o notas */}
                      {Object.keys(viewingLog.symptoms || {}).length > 0 && (
                        <div>
                          <h4 className="font-bold text-lg text-gray-300">Síntomas Reportados (Formato anterior):</h4>
                          <ul className="list-disc list-inside text-gray-200">
                            {Object.entries(viewingLog.symptoms).map(([symptom, severity]) => (
                              <li key={symptom}>{symptom}: {severity}</li>
                            ))}
                          </ul>
                        </div>
                      )}


                      <div>
                        <h4 className="font-bold text-lg text-gray-300">Notas Adicionales:</h4>
                        <p className="text-gray-200 whitespace-pre-wrap">{viewingLog.notes || 'Ninguna nota adicional.'}</p>
                      </div>

                      {/* Botón para eliminar el registro */}
                      <button
                        onClick={() => deleteSymptomLog(viewingLog.timestamp.toISOString())}
                        className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors duration-200 shadow-md mt-4"
                      >
                        Eliminar Registro del Día
                      </button>
                    </div>
                  ) : ( // Si no hay registro seleccionado, mostrar el formulario y la lista
                    <>
                      <div className="bg-gray-700 p-4 rounded-md shadow-sm space-y-4">
                        <p className="text-gray-200 mb-2">
                          Registra tus comidas y síntomas diarios para identificar patrones.
                        </p>

                        {/* Selector de Fecha */}
                        <div>
                          <label htmlFor="logDate" className="block text-gray-300 text-sm font-bold mb-1">Fecha:</label>
                          <input
                            type="date"
                            id="logDate"
                            className="w-full p-2 rounded-md bg-gray-800 text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            value={selectedDate}
                            onChange={(e) => setSelectedDate(e.target.value)}
                          />
                        </div>

                        {/* REGISTRO DE INGESTAS INDIVIDUALES */}
                        <div className="bg-gray-800 p-4 rounded-md shadow-sm space-y-3">
                          <h4 className="font-bold text-lg text-blue-300 mb-2">Añadir Nueva Comida:</h4>
                          
                          <div>
                            <label htmlFor="ingestionType" className="block text-gray-300 text-sm font-bold mb-1">Tipo de Ingesta:</label>
                            <select
                              id="ingestionType"
                              className="w-full p-2 rounded-md bg-gray-800 text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
                              value={currentIngestionType}
                              onChange={(e) => setCurrentIngestionType(e.target.value)}
                            >
                              {ingestionTypes.map(type => (
                                <option key={type} value={type}>{type}</option>
                              ))}
                            </select>
                          </div>

                          <div>
                            <label htmlFor="ingestionDesc" className="block text-gray-300 text-sm font-bold mb-1">Descripción de la Comida:</label>
                            <textarea
                              id="ingestionDesc"
                              className="w-full p-3 rounded-md bg-gray-900 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                              rows="3"
                              placeholder="Ej: Avena con leche de almendras, arándanos y proteína en polvo."
                              value={currentIngestionDescription}
                              onChange={(e) => setCurrentIngestionDescription(e.target.value)}
                            ></textarea>
                          </div>

                          <div>
                            <label className="block text-gray-300 text-sm font-bold mb-1">¿Cómo te sentó?</label>
                            <div className="flex justify-around space-x-2">
                              {['Bien', 'Regular', 'Mal'].map(reaction => (
                                <button
                                  key={reaction}
                                  onClick={() => setCurrentIngestionReaction(reaction)}
                                  className={`px-4 py-2 text-sm rounded-md font-semibold transition-colors duration-200 ${
                                    currentIngestionReaction === reaction
                                      ? 'bg-blue-600 text-white shadow-md'
                                      : 'bg-gray-600 text-gray-300 hover:bg-gray-500'
                                  }`}
                                >
                                  {reaction}
                                </button>
                              ))}
                            </div>
                          </div>

                          <button
                            onClick={addIngestion}
                            className="w-full px-4 py-2 rounded-md font-semibold bg-blue-600 text-white hover:bg-blue-700 transition-colors duration-200 shadow-md"
                          >
                            Añadir Comida del Día
                          </button>
                        </div> {/* Fin REGISTRO DE INGESTAS INDIVIDUALES */}

                        {/* LISTADO DE INGESTAS DEL DÍA (PARA EL FORMULARIO ACTUAL) */}
                        {dailyIngestas.length > 0 && (
                          <div className="bg-gray-800 p-4 rounded-md shadow-sm mt-4">
                            <h4 className="font-bold text-lg text-orange-300 mb-2">Comidas Registradas para hoy ({selectedDate}):</h4>
                            <ul className="list-disc list-inside text-gray-200 space-y-2">
                              {dailyIngestas.map((ingesta, index) => (
                                <li key={index} className="flex justify-between items-center bg-gray-700 p-2 rounded-md">
                                  <span>
                                    <span className="font-semibold">{ingesta.type}:</span> {ingesta.description} (<span className={`font-semibold ${
                                        ingesta.reaction === 'Bien' ? 'text-green-400' :
                                        ingesta.reaction === 'Regular' ? 'text-yellow-400' : 'text-red-400'
                                    }`}>{ingesta.reaction}</span>)
                                  </span>
                                  <button
                                    onClick={() => removeIngestion(index)}
                                    className="text-red-400 hover:text-red-600 text-sm ml-2"
                                  >
                                    Eliminar
                                  </button>
                                </li>
                              ))}
                            </ul>
                          </div>
                        )}

                        {/* Notas Adicionales (se mantiene) */}
                        <div>
                          <label htmlFor="notes" className="block text-gray-300 text-sm font-bold mb-1">Notas Adicionales del día (ej. estrés, ejercicio, medicación, reacción general):</label>
                          <textarea
                            id="notes"
                            className="w-full p-3 rounded-md bg-gray-800 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            rows="3"
                            placeholder="Ej: Hoy me sentí bastante bien en general. El estrés fue moderado. No tomé medicación extra."
                            value={symptomNotes}
                            onChange={(e) => setSymptomNotes(e.target.value)}
                          ></textarea>
                        </div>

                        {/* Botón Guardar Registro del DÍA */}
                        <button
                          onClick={saveSymptomLog}
                          className="w-full px-4 py-2 rounded-md font-semibold bg-green-600 text-white hover:bg-green-700 transition-colors duration-200 shadow-md"
                        >
                          Guardar Registro Completo del Día
                        </button>
                        {logMessage && (
                          <p className="text-center text-sm text-green-400 mt-2">{logMessage}</p>
                        )}
                      </div>

                      {/* Historial de Registros Agrupado y Desplegable */}
                      <div className="mt-8">
                        <h3 className="text-xl sm:text-2xl font-bold text-white mb-4 text-center">Historial de Registros</h3>
                        {symptomLogs.length === 0 ? (
                          <p className="text-gray-400 text-center">No hay registros guardados aún. ¡Empieza a añadir!</p>
                        ) : (
                          Object.entries(groupedSymptoms).sort(([yearA], [yearB]) => parseInt(yearB) - parseInt(yearA)).map(([year, months]) => (
                            <div key={year} className="mb-6 bg-gray-700 p-3 rounded-md shadow-sm">
                              <h4 
                                className="text-xl font-bold text-purple-400 mb-2 cursor-pointer flex justify-between items-center"
                                onClick={() => toggleYear(year)}
                              >
                                {year} {expandedYears[year] ? '▼' : '▶'}
                              </h4>
                              {expandedYears[year] && (
                                <div className="ml-4">
                                  {Object.entries(months).sort(([monthNameA], [monthNameB]) => {
                                    const monthOrder = ["diciembre", "noviembre", "octubre", "septiembre", "agosto", "julio", "junio", "mayo", "abril", "marzo", "febrero", "enero"]; // Orden descendente
                                    return monthOrder.indexOf(monthNameA) - monthOrder.indexOf(monthNameB);
                                  }).map(([month, weeks]) => (
                                    <div key={month} className="mb-4">
                                      <h5 
                                        className="text-lg font-bold text-green-400 mb-2 cursor-pointer flex justify-between items-center"
                                        onClick={() => toggleMonth(year, month)}
                                      >
                                        {month.charAt(0).toUpperCase() + month.slice(1)} {expandedMonths[`${year}-${month}`] ? '▼' : '▶'}
                                      </h5>
                                      {expandedMonths[`${year}-${month}`] && (
                                        <div className="ml-4">
                                          {Object.entries(weeks).sort(([weekA], [weekB]) => parseInt(weekB) - parseInt(weekA)).map(([week, logsInWeek]) => (
                                            <div key={week} className="mb-3">
                                              <h6 
                                                className="text-base font-semibold text-orange-300 mb-2 cursor-pointer flex justify-between items-center"
                                                onClick={() => toggleWeek(year, week)}
                                              >
                                                Semana {week} {expandedWeeks[`${year}-${week}`] ? '▼' : '▶'}
                                              </h6>
                                              {expandedWeeks[`${year}-${week}`] && (
                                                <div className="space-y-2">
                                                  {logsInWeek.map((log) => (
                                                    <div 
                                                      key={log.timestamp} 
                                                      className="bg-gray-800 p-3 rounded-md shadow-sm flex justify-between items-center cursor-pointer hover:bg-gray-600 transition-colors duration-200"
                                                      onClick={() => setViewingLog(log)}
                                                    >
                                                      <span className="text-gray-200 font-medium">
                                                        {log.date.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}
                                                      </span>
                                                      <span className="text-blue-300">Ver Detalles →</span>
                                                    </div>
                                                  ))}
                                                </div>
                                              )}
                                            </div>
                                          ))}
                                        </div>
                                      )}
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          ))
                        )}
                      </div>
                    </>
                  )}
                </div>
              )}
            </main>

            {/* Footer */}
            <footer className="w-full max-w-4xl mt-8 p-4 text-center text-gray-400 text-sm">
              <p>Tu Guía SIBO - Creada por modulogica.</p>
              <p>Recuerda siempre consultar a un profesional de la salud.</p>
            </footer>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
